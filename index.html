<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>刘方园&&田烩的婚礼邀请函</title>
    <link rel="preload" href="爱的就是你.MP3" as="audio" type="audio/mpeg">

    <link rel="stylesheet" href="wedding.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">

    <!-- 基础网页信息 -->
    <meta name="description" content="诚邀您参加刘方园和田烩的婚礼，共赴这场浪漫之约～">
    <meta name="keywords" content="婚礼,邀请函,刘方园,田烩,结婚,浪漫">

    <!-- 1. 通用OG标签：用于微信分享预览弹窗（宽图，1200×630） -->
    <meta property="og:title" content="刘方园&&田烩的婚礼邀请函">
    <meta property="og:description" content="诚邀您参加刘方园和田烩的婚礼，共赴这场浪漫之约～">
    <meta property="og:image" content="https://tiangangan.cn/y_339A2922_1.jpg?v=20250215"> <!-- 替换成你的宽图链接 -->
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/jpeg"> <!-- 修正格式 -->
    <meta property="og:url" content="https://tiangangan.cn/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="刘方园&&田烩的婚礼邀请函">

    <!-- 2. 微信专属标签：用于朋友圈信息流（正方形图，800×800，人物完整） -->
    <meta name="wechat-webview-share-title" content="刘方园&&田烩的婚礼邀请函">
    <meta name="wechat-webview-share-desc" content="诚邀您参加刘方园和田烩的婚礼，共赴这场浪漫之约～">
    <meta name="wechat-webview-share-image" content="https://tiangangan.cn/1.jpg?v=20250215">
    <!-- 替换成你的正方形图链接 -->
    <meta name="wx:share:title" content="刘方园&&田烩的婚礼邀请函">
    <meta name="wx:share:description" content="诚邀您参加刘方园和田烩的婚礼，共赴这场浪漫之约～">
    <meta name="wx:share:image" content="https://tiangangan.cn/1.jpg?v=20250215"> <!-- 替换成你的正方形图链接 -->
</head>

<body>
    <!-- ========== 加载页 ========== -->
    <div id="loader">
        <div class="loader-title">刘方园and田烩de婚礼邀请函</div>
        <div class="loader-progress">
            <div class="loader-bar" id="loaderBar"></div>
        </div>
        <div class="loader-text" id="loaderText">正在加载甜蜜回忆... 0%</div>
    </div>

    <!-- ========== 主内容 ========== -->
    <div class="container" id="mainContainer">
        <div class="music-btn" id="musicBtn">
            &#127928;
        </div>
        <header id="header">
            <h2>来自刘方园&&田烩的一封婚礼邀请函</h2>
        </header>
        <main>
            <section>
                <p class="dingdong-row">
                    叮咚!
                    <img src="贴纸1.gif"><br />
                    💌您已收到来自刘方园和田烩的婚礼邀请函 💌
                    <br /><br />
                </p>
                <p>
                    当心动撞个满怀，当温柔有了归处<br />
                    我们终于要把"喜欢"升级成"一辈子"啦！<br />
                    诚邀各位亲友伙伴<br />
                    共赴这场充满烟火气的浪漫之约
                </p>
            </section>
            <section class="couple-section">
                <div class="couple-card">
                    <img src="y_339A3037_1.jpg" alt="新郎">
                    <div class="couple-text">
                        <p class="art-font">Groom</p>
                        <p class="role">新郎&#128102;</p>
                        <p class="name">刘方园</p>
                    </div>
                </div>
                <div class="couple-card">
                    <img src="y_339A3067_1.jpg" alt="新娘">
                    <div class="couple-text">
                        <p class="art-font">Bride</p>
                        <p class="role">新娘&#128103;</p>
                        <p class="name">田烩</p>
                    </div>
                </div>
            </section>
            <br />
            <section>
                <p>
                    接下来请跟随我们的甜蜜足迹<br />
                    解锁从"我"到"我们"的浪漫旅程~<br />
                    （小提示：&#128071;下滑解锁更多甜蜜暴击~）<br />
                </p>
                <br />
                <div class="art-image-container">
                    <div class="art-image-wrapper">
                        <img src="y_339A2998_1.jpg" alt="甜蜜瞬间" class="art-image">
                    </div>
                    <div class="art-title">
                        invitation<img src="贴纸6.gif">
                    </div>
                </div>
            </section>
            <section>
                <div>
                    <p>
                        爱情是最小单位的共产主义<br />
                        在我们的二人国度里<br />
                        没有阶级的划分，没有贫富的差距。<br /><br />
                    </p>
                    <p>
                        我们以“共同”为底色<br />
                        共享三餐四季的烟火、共筑灵魂同频的共鸣<br />
                        就像共产主义追求的共同富裕<br />
                        追求的是物质与精神的高度统一<br />
                        我们也在物质与精神的同频里<br />
                        把日子过成圆满的模样。<br /><br /><br />
                    </p>
                </div>
            </section>
            <section>
                <div class="art-photo-module">
                    <p class="art-text art-text-yes">Yes,</p>
                    <p class="art-text art-text-ido">I do.</p>
                    <img src="y_339A3095_1.jpg" class="module-photo-right">
                    <img src="y_339A3104_1.jpg" class="module-photo-left">
                </div>
            </section>
            <br /><br />
            <section>
                <div>
                    <h3>💫 关于我们的小剧场 💫</h3>
                    从初遇到相守<br />
                    每一段时光都写满了温柔与默契<br />
                    那些藏在日常里的小甜蜜<br />
                    构成了我们专属的爱情故事～<br /><br />
                </div>
                <div class="split-layout1">
                    <div class="split-text1">
                        <h4>【相恋&#128144;】</h4>
                        是双向奔赴的甜蜜<br />
                        爱意在细碎的时光里慢慢扎根<br />
                        我们一起解锁了很多第一次<br />
                        一起把平淡的日子过成了诗<br />
                        <p class="split-slogan1">LOVE YOU</p>
                        <p class="split-slogan1">FOREVER</p>
                    </div>
                    <div class="split-img1">
                        <img src="y_339A3001_1.jpg" alt="相恋时光">
                    </div>
                </div>
                <div class="split-layout2">
                    <div class="split-img2">
                        <img src="y_339A3042_1.jpg" alt="相守时刻">
                    </div>
                    <div class="split-text2">
                        <p class="split-slogan2">LOVE NEVER</p>
                        <p class="split-slogan2">FAILS</p>
                        <h4>【相守&#128141;】</h4>
                        是自然而然的决定<br />
                        从此，我们不仅是彼此的爱人<br />
                        更是并肩同行的伙伴<br />
                        这份双向奔赴的深情<br />
                        就是我们爱情最美好的见证<br />
                    </div>
                </div>
            </section>
            <br /><br /><br />
            <section>
                <div class="double-wrap">
                    <div class="double-text">
                        一个人可以走得很快，但两个人&#128158;走更有意义<br />
                        是你把我的犹豫变成坚定，把我的孤单变成热闹<br />
                        双向奔赴的意义，就是“好巧，我也刚好喜欢你”<br />
                        这一次，喜欢和合适撞了个满怀，真好<br />
                    </div>
                    <br /><br />
                    <div class="double-img-container">
                        <img src="y_339A3313_1.jpg">
                        <img src="y_339A3240_1.jpg">
                    </div>
                </div>
            </section>
            <br /><br /><br />
            <section>
                <div>
                    <h3>&#128198; 重要日期</h3>
                    2026年2月12日~2月13日<br />
                    农历十二月二十五~二十六
                </div>
            </section>
            <br /><br />
            <section>
                <div class="countdown-container">
                    <div class="countdown-nums">
                        <div class="countdown-item">
                            <span id="days">00</span>
                            <p>天</p>
                        </div>
                        <div class="countdown-item">
                            <span id="hours">00</span>
                            <p>时</p>
                        </div>
                        <div class="countdown-item">
                            <span id="minutes">00</span>
                            <p>分</p>
                        </div>
                        <div class="countdown-item">
                            <span id="seconds">00</span>
                            <p>秒</p>
                        </div>
                    </div>
                    <div class="countdown-img">
                        <img src="y_339A3284_1.jpg">
                    </div>
                </div>
            </section>
            <br /><br /><br />
            <section>
                <div>
                    <h3>&#9962;幸福坐标</h3>
                    <div class="address-section">
                        <div class="address-list">
                            <div class="address-item">
                                <div class="address-map">
                                    <img src="小方地图.png">
                                </div>
                                <div class="address-info">
                                    <a href="https://surl.amap.com/1Q3DtW61kaQH" target="_blank">
                                        <p>
                                            遵义市绥阳县坪乐镇顺河村<br />
                                            (点击导航)
                                        </p>
                                    </a>
                                </div>
                            </div>
                            <div class="address-item">
                                <div class="address-map">
                                    <img src="烩地图.png">
                                </div>
                                <div class="address-info">
                                    <a href="https://www.amap.com/place/B03541917C" target="_blank">
                                        <p>
                                            遵义市红花岗区深溪镇大窝村<br />
                                            (点击导航)
                                        </p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
            </section>
            <br /><br /><br />
            <section>
                <div>
                    <h3>💌 赴约小tips<br /><br /></h3>
                </div>
                <div>
                    <h4>【远程参与彩蛋】</h4>
                    若你暂被距离/琐事绊住脚步<br />
                    无需挂心——发送任意形式的祝福<br />
                    即可解锁「远程幸福贡献者」称号，我们会把这份牵挂妥善存档<br /><br />
                    <h4>【入场必备Buff】</h4>
                    赴约请携带「100% 松弛感+感知甜份的雷达」<br />
                    今日的现场没有"标准流程"，你只管带着舒展的状态来~<br /><br />
                    <h4>【画面捕捉图鉴<img src="贴纸2.gif" class="sticker-2">】</h4>
                    现场已解锁「氛围感拍摄打卡点」<br />
                    自带「摆拍指令豁免权」，无需硬凹造型<br />
                    随手定格的每一帧，都是今天独一份的生动画面～
                </div>
                <div>
                    <div id="wedding-photo_wrap"></div>
                </div>
            </section>
            <section>
                <div id="ending">
                    <p>
                        🎊 我们的婚礼，因你而圆满 🎊<br />
                        不追求盛大奢华，只希望与最爱的家人朋友们<br />
                        一起分享这份喜悦，见证我们的幸福时刻<br />
                        期待与你，在充满爱的氛围里，共赴这场浪漫之约<br /><br />
                    </p>
                    &#128150; 感谢看到这里的你 &#128150;<br />
                    我们的爱情序章落笔收梢，满溢的幸福即将启程<br />
                    2026年2月13日，我们候你赴约<br />
                    一起见证“我”蜕变成“我们”的珍贵时刻<br />
                    共赴往后岁岁年年的崭新篇章<br />
                    盼你携着祝福而来，与我们一同定格这份圆满<br />
                </div>
            </section>
        </main>
    </div>

    <!-- 音频元素 -->
    <audio id="bg-music" loop preload="auto" src="爱的就是你.MP3">
        <source src="爱的就是你.MP3" type="audio/mp3">
    </audio>

    <script>
        // ========== 1. 预加载资源配置 ==========
        const resources = {
            images: [
                "y_339A2922_1.jpg",
                "y_339A2998_1.jpg",
                "y_339A3001_1.jpg",
                "y_339A3042_1.jpg",
                "y_339A3067_1.jpg",
                "y_339A3095_1.jpg",
                "y_339A3104_1.jpg",
                "y_339A3240_1.jpg",
                "小方地图.png",
                "烩地图.png",
                "y_339A3284_1.jpg",
                "y_339A3313_1.jpg"
            ],
            audio: []
        };

        // ========== 2. 加载进度管理 ==========
        let loadedCount = 0;
        const totalCount = resources.images.length + resources.audio.length;
        const loaderBar = document.getElementById('loaderBar');
        const loaderText = document.getElementById('loaderText');
        const loader = document.getElementById('loader');
        const mainContainer = document.getElementById('mainContainer');

        // 新增：15秒超时兜底，防止移动端加载卡死
        let loadTimeout = setTimeout(() => {
            console.log('加载超时，强制进入主页面');
            completeLoading();
        }, 8000);

        // 更新加载进度
        function updateProgress() {
            const progress = Math.floor((loadedCount / totalCount) * 100);
            loaderBar.style.width = `${progress}%`;
            loaderText.textContent = `正在加载甜蜜回忆... ${progress}%`;
            if (loadedCount >= totalCount || progress >= 80) {
                completeLoading();
            }
        }

        // 新增：封装加载完成逻辑，统一处理样式切换
        function completeLoading() {
            clearTimeout(loadTimeout);
            mainContainer.style.display = 'block';

            // 延迟执行淡出效果，确保渲染完成
            setTimeout(() => {
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';

                // 添加小延迟后显示主内容
                setTimeout(() => {
                    mainContainer.style.opacity = '1';
                    mainContainer.classList.add('show');
                    initMainFunctions();
                }, 100);
            }, 300);
        }

        // ========== 3. 预加载图片（优化版，防缓存+适配移动端） ==========
        function preloadImages() {
            resources.images.forEach(src => {
                const img = new Image();
                img.src = src;
                img.onload = () => { loadedCount++; updateProgress(); };
                img.onerror = () => { console.warn(`图片加载失败: ${src}`); loadedCount++; updateProgress(); };
                img.onloadstart = () => {
                    if (!img.dataset.counted) {
                        img.dataset.counted = true;
                        loadedCount++;
                        updateProgress();
                    }
                };
            });
        }

        // ========== 4. 预加载音频（优化版，降级预加载+防缓存） ==========
        function preloadAudio() {
            resources.audio.forEach(src => {
                const audio = new Audio();
                audio.src = src + '?t=' + new Date().getTime(); // 加时间戳防缓存
                audio.preload = 'metadata'; // 移动端降级，只加载元数据
                audio.addEventListener('loadedmetadata', () => { loadedCount++; updateProgress(); }, { once: true });
                audio.addEventListener('error', () => { console.warn(`音频加载失败: ${src}`); loadedCount++; updateProgress(); }, { once: true });
            });
        }

        // ========== 5. 主页面功能初始化 ==========
        function initMainFunctions() {
            const bgMusic = document.getElementById('bg-music');
            const musicBtn = document.getElementById('musicBtn');
            const container = document.querySelector('.container');

            let musicPlayed = false;
            let hasPlayedByScroll = false;
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isWechatIOS = isIOS && /MicroMessenger/i.test(navigator.userAgent);

            let isPlaying = false;
            updateMusicButtonState();

            musicBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleMusic();
            });
            musicBtn.addEventListener('touchstart', function (e) {
                e.preventDefault();
                toggleMusic();
            }, { passive: false });

            function toggleMusic() {
                if (bgMusic.paused) {
                    bgMusic.muted = false;
                    bgMusic.play().then(() => {
                        isPlaying = true;
                        musicPlayed = true;
                        updateMusicButtonState();
                    }).catch(err => {
                        console.log('音乐播放失败:', err);
                        if (isIOS) {
                            alert('请点击"允许"播放音乐');
                        }
                    });
                } else {
                    bgMusic.pause();
                    isPlaying = false;
                    updateMusicButtonState();
                }
            }

            function updateMusicButtonState() {
                if (bgMusic.paused) {
                    musicBtn.classList.remove('playing');
                    musicBtn.classList.add('paused');
                    musicBtn.innerHTML = '&#127928;';
                    musicBtn.title = '点击播放音乐';
                } else {
                    musicBtn.classList.add('playing');
                    musicBtn.classList.remove('paused');
                    musicBtn.innerHTML = '&#127928;';
                    musicBtn.title = '点击暂停音乐';
                }
            }

            bgMusic.addEventListener('play', () => {
                isPlaying = true;
                updateMusicButtonState();
            });

            bgMusic.addEventListener('pause', () => {
                isPlaying = false;
                updateMusicButtonState();
            });

            bgMusic.addEventListener('error', () => {
                console.log('音频加载错误');
                musicBtn.innerHTML = '&#127928;';
                musicBtn.title = '音乐加载失败';
            });

            // 新增：防抖逻辑，解决移动端重复触发
            let touchPlayDebounce = false;
            function playMusicOnWechatScroll() {
                if (touchPlayDebounce || hasPlayedByScroll || !bgMusic.paused) return;
                touchPlayDebounce = true;
                bgMusic.play().then(() => {
                    isPlaying = true;
                    musicPlayed = true;
                    hasPlayedByScroll = true;
                    updateMusicButtonState();
                }).catch(err => {
                    console.log('滑动触发播放失败:', err);
                    musicBtn.title = '点击播放音乐';
                });
                setTimeout(() => { touchPlayDebounce = false; }, 1000);
            }

            container.addEventListener('touchstart', playMusicOnWechatScroll, {
                passive: true,
                capture: true
            });

            container.addEventListener('touchmove', playMusicOnWechatScroll, {
                passive: true,
                capture: true
            });

            window.addEventListener('scroll', playMusicOnWechatScroll, { passive: true });
            container.addEventListener('wheel', playMusicOnWechatScroll, { passive: true });

            // 倒计时功能
            function setupCountdown() {
                const weddingTime = new Date("2026-02-13 13:14:00").getTime();
                const els = {
                    days: document.getElementById('days'),
                    hours: document.getElementById('hours'),
                    minutes: document.getElementById('minutes'),
                    seconds: document.getElementById('seconds')
                };

                function update() {
                    const diff = weddingTime - new Date().getTime();
                    if (diff <= 0) {
                        Object.values(els).forEach(el => el.innerText = '00');
                        return;
                    }
                    els.days.innerText = Math.floor(diff / 86400000).toString().padStart(2, '0');
                    els.hours.innerText = Math.floor((diff % 86400000) / 3600000).toString().padStart(2, '0');
                    els.minutes.innerText = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                    els.seconds.innerText = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                }
                update();
                setInterval(update, 1000);
            }

            // 页面可见性处理
            function setupVisibilityHandler() {
                let hidden, visibilityChange;
                if (typeof document.hidden !== "undefined") {
                    hidden = "hidden";
                    visibilityChange = "visibilitychange";
                } else if (typeof document.msHidden !== "undefined") {
                    hidden = "msHidden";
                    visibilityChange = "msvisibilitychange";
                } else if (typeof document.webkitHidden !== "undefined") {
                    hidden = "webkitHidden";
                    visibilityChange = "webkitvisibilitychange";
                }

                function handleVisibilityChange() {
                    if (document[hidden]) {
                        if (!bgMusic.paused) bgMusic.pause();
                    } else {
                        if (musicPlayed && bgMusic.paused) {
                            bgMusic.play().catch(() => { });
                        }
                    }
                }

                if (typeof document.addEventListener !== "undefined" && hidden !== undefined) {
                    document.addEventListener(visibilityChange, handleVisibilityChange, false);
                }
            }

            setupCountdown();
            setupVisibilityHandler();
            musicBtn.title = '点击播放/暂停音乐';
        }

        // ========== 6. 开始预加载（适配移动端） ==========
        window.addEventListener('DOMContentLoaded', () => {
            preloadImages();
        });
    </script>
</body>


</html>