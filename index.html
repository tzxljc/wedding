<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>åˆ˜æ–¹å›­&&ç”°çƒ©çš„å©šç¤¼é‚€è¯·å‡½</title>
    <link rel="preload" href="çˆ±çš„å°±æ˜¯ä½ .MP3" as="audio" type="audio/mpeg">

    <link rel="stylesheet" href="wedding.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Parisienne&display=swap" rel="stylesheet">

    <!-- åŸºç¡€ç½‘é¡µä¿¡æ¯ -->
    <meta name="description" content="è¯šé‚€æ‚¨å‚åŠ åˆ˜æ–¹å›­å’Œç”°çƒ©çš„å©šç¤¼ï¼Œå…±èµ´è¿™åœºæµªæ¼«ä¹‹çº¦ï½">
    <meta name="keywords" content="å©šç¤¼,é‚€è¯·å‡½,åˆ˜æ–¹å›­,ç”°çƒ©,ç»“å©š,æµªæ¼«">

    <!-- 1. é€šç”¨OGæ ‡ç­¾ -->
    <meta property="og:title" content="åˆ˜æ–¹å›­&&ç”°çƒ©çš„å©šç¤¼é‚€è¯·å‡½">
    <meta property="og:description" content="è¯šé‚€æ‚¨å‚åŠ åˆ˜æ–¹å›­å’Œç”°çƒ©çš„å©šç¤¼ï¼Œå…±èµ´è¿™åœºæµªæ¼«ä¹‹çº¦ï½">
    <meta property="og:image" content="https://tiangangan.cn/y_339A2922_1.jpg?v=20250215">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:url" content="https://tiangangan.cn/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="åˆ˜æ–¹å›­&&ç”°çƒ©çš„å©šç¤¼é‚€è¯·å‡½">

    <!-- 2. å¾®ä¿¡ä¸“å±æ ‡ç­¾ -->
    <meta name="wechat-webview-share-title" content="åˆ˜æ–¹å›­&&ç”°çƒ©çš„å©šç¤¼é‚€è¯·å‡½">
    <meta name="wechat-webview-share-desc" content="è¯šé‚€æ‚¨å‚åŠ åˆ˜æ–¹å›­å’Œç”°çƒ©çš„å©šç¤¼ï¼Œå…±èµ´è¿™åœºæµªæ¼«ä¹‹çº¦ï½">
    <meta name="wechat-webview-share-image" content="https://tiangangan.cn/1.jpg?v=20250215">
    <meta name="wx:share:title" content="åˆ˜æ–¹å›­&&ç”°çƒ©çš„å©šç¤¼é‚€è¯·å‡½">
    <meta name="wx:share:description" content="è¯šé‚€æ‚¨å‚åŠ åˆ˜æ–¹å›­å’Œç”°çƒ©çš„å©šç¤¼ï¼Œå…±èµ´è¿™åœºæµªæ¼«ä¹‹çº¦ï½">
    <meta name="wx:share:image" content="https://tiangangan.cn/1.jpg?v=20250215">
</head>

<body>
    <!-- åŠ è½½é¡µ -->
    <div id="loader">
        <div class="loader-title">åˆ˜æ–¹å›­andç”°çƒ©deå©šç¤¼é‚€è¯·å‡½</div>
        <div class="loader-progress">
            <div class="loader-bar" id="loaderBar"></div>
        </div>
        <div class="loader-text" id="loaderText">æ­£åœ¨åŠ è½½ç”œèœœå›å¿†... 0%</div>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="container" id="mainContainer">
        <div class="music-btn" id="musicBtn">
            &#127928;
        </div>
        <header id="header">
            <h2>æ¥è‡ªåˆ˜æ–¹å›­&&ç”°çƒ©çš„ä¸€å°å©šç¤¼é‚€è¯·å‡½</h2>
        </header>
        <main>
            <!-- åŸé¡µé¢å†…å®¹ä¸å˜ï¼Œæ­¤å¤„çœç•¥ï¼ˆå’Œä½ åŸä»£ç ä¸€è‡´ï¼‰ -->
            <section>
                <p class="dingdong-row">
                    å®å’š!
                    <img src="è´´çº¸1.gif"><br />
                    ğŸ’Œæ‚¨å·²æ”¶åˆ°æ¥è‡ªåˆ˜æ–¹å›­å’Œç”°çƒ©çš„å©šç¤¼é‚€è¯·å‡½ ğŸ’Œ
                    <br /><br />
                </p>
                <p>
                    å½“å¿ƒåŠ¨æ’ä¸ªæ»¡æ€€ï¼Œå½“æ¸©æŸ”æœ‰äº†å½’å¤„<br />
                    æˆ‘ä»¬ç»ˆäºè¦æŠŠ"å–œæ¬¢"å‡çº§æˆ"ä¸€è¾ˆå­"å•¦ï¼<br />
                    è¯šé‚€å„ä½äº²å‹ä¼™ä¼´<br />
                    å…±èµ´è¿™åœºå……æ»¡çƒŸç«æ°”çš„æµªæ¼«ä¹‹çº¦
                </p>
            </section>
            <section class="couple-section">
                <div class="couple-card">
                    <img src="y_339A3037_1.jpg" alt="æ–°éƒ">
                    <div class="couple-text">
                        <p class="art-font">Groom</p>
                        <p class="role">æ–°éƒ&#128102;</p>
                        <p class="name">åˆ˜æ–¹å›­</p>
                    </div>
                </div>
                <div class="couple-card">
                    <img src="y_339A3067_1.jpg" alt="æ–°å¨˜">
                    <div class="couple-text">
                        <p class="art-font">Bride</p>
                        <p class="role">æ–°å¨˜&#128103;</p>
                        <p class="name">ç”°çƒ©</p>
                    </div>
                </div>
            </section>
            <!-- ä»¥ä¸‹æ‰€æœ‰é¡µé¢å†…å®¹å’Œä½ åŸä»£ç å®Œå…¨ä¸€è‡´ï¼Œä¸å†é‡å¤ -->
        </main>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="bg-music" loop preload="auto" src="çˆ±çš„å°±æ˜¯ä½ .MP3">
        <source src="çˆ±çš„å°±æ˜¯ä½ .MP3" type="audio/mp3">
    </audio>

    <script>
        // ========== 1. é¢„åŠ è½½èµ„æºé…ç½® ==========
        const resources = {
            images: [
                "y_339A2922_1.jpg",
                "y_339A2998_1.jpg",
                "y_339A3001_1.jpg",
                "y_339A3037_1.jpg",
                "y_339A3042_1.jpg",
                "y_339A3067_1.jpg",
                "y_339A3095_1.jpg",
                "y_339A3104_1.jpg",
                "y_339A3240_1.jpg",
                // ã€ä¼˜åŒ–ã€‘ç§»é™¤æœªä½¿ç”¨çš„å›¾ç‰‡ï¼Œå‡å°‘åŠ è½½é‡
                // "y_339A3249_1.jpg",
                "å°æ–¹åœ°å›¾.png",
                "çƒ©åœ°å›¾.png",
                // "y_339A3259_1.jpg",
                "y_339A3284_1.jpg",
                "y_339A3313_1.jpg"
            ],
            audio: [
                // ã€ä¼˜åŒ–ã€‘ç§»é™¤éŸ³é¢‘é¢„åŠ è½½ï¼Œæ”¹ä¸ºç‚¹å‡»æ’­æ”¾æ—¶åŠ è½½
                // "çˆ±çš„å°±æ˜¯ä½ .MP3"
            ]
        };

        // ========== 2. åŠ è½½è¿›åº¦ç®¡ç† ==========
        let loadedCount = 0;
        const totalCount = resources.images.length + resources.audio.length;
        const loaderBar = document.getElementById('loaderBar');
        const loaderText = document.getElementById('loaderText');
        const loader = document.getElementById('loader');
        const mainContainer = document.getElementById('mainContainer');

        // ã€ä¼˜åŒ–ã€‘è¶…æ—¶æ—¶é—´ä»15ç§’ç¼©çŸ­åˆ°8ç§’
        let loadTimeout = setTimeout(() => {
            console.log('åŠ è½½è¶…æ—¶ï¼Œå¼ºåˆ¶è¿›å…¥ä¸»é¡µé¢');
            completeLoading();
        }, 8000); // åŸä»£ç æ˜¯15000

        // æ›´æ–°åŠ è½½è¿›åº¦
        function updateProgress() {
            const progress = Math.floor((loadedCount / totalCount) * 100);
            loaderBar.style.width = `${progress}%`;
            loaderText.textContent = `æ­£åœ¨åŠ è½½ç”œèœœå›å¿†... ${progress}%`;
            // ã€ä¼˜åŒ–ã€‘è¿›åº¦åˆ°80%æˆ–åŠ è½½å®Œæˆéƒ½è¿›å…¥ä¸»é¡µé¢ï¼ˆåŸä»£ç åªæœ‰åŠ è½½å®Œæˆæ‰è¿›å…¥ï¼‰
            if (loadedCount >= totalCount || progress >= 80) {
                completeLoading();
            }
        }

        function completeLoading() {
            clearTimeout(loadTimeout);
            mainContainer.style.display = 'block';
            setTimeout(() => {
                loader.style.opacity = '0';
                loader.style.visibility = 'hidden';
                setTimeout(() => {
                    mainContainer.style.opacity = '1';
                    mainContainer.classList.add('show');
                    initMainFunctions();
                }, 100);
            }, 300);
        }

        // ========== 3. é¢„åŠ è½½å›¾ç‰‡ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ==========
        function preloadImages() {
            resources.images.forEach(src => {
                const img = new Image();
                // ã€ä¼˜åŒ–ã€‘å»æ‰æ—¶é—´æˆ³ï¼Œå…è®¸ç¼“å­˜ï¼ˆåŸä»£ç æœ‰?t=æ—¶é—´æˆ³ï¼‰
                img.src = src;
                img.onload = () => { loadedCount++; updateProgress(); };
                img.onerror = () => { console.warn(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${src}`); loadedCount++; updateProgress(); };
                // ã€ä¼˜åŒ–ã€‘æ–°å¢ï¼šå›¾ç‰‡å¼€å§‹åŠ è½½å°±è®¡æ•°ï¼Œè¿›åº¦æ¡æ›´å¿«åŠ¨èµ·æ¥
                img.onloadstart = () => {
                    if (!img.dataset.counted) {
                        img.dataset.counted = true;
                        loadedCount++;
                        updateProgress();
                    }
                };
            });
        }

        // ========== 4. é¢„åŠ è½½éŸ³é¢‘ï¼ˆä¼˜åŒ–åï¼šç§»é™¤ï¼‰ ==========
        // åŸä»£ç çš„preloadAudioå‡½æ•°å·²åˆ é™¤ï¼ŒéŸ³é¢‘ä¸å†é¢„åŠ è½½

        // ========== 5. ä¸»é¡µé¢åŠŸèƒ½åˆå§‹åŒ– ==========
        function initMainFunctions() {
            // è¿™éƒ¨åˆ†ä»£ç å’Œä½ åŸä»£ç å®Œå…¨ä¸€è‡´ï¼Œæ²¡æœ‰ä¿®æ”¹ï¼ˆéŸ³ä¹æ’­æ”¾é€»è¾‘ä¸å˜ï¼‰
            const bgMusic = document.getElementById('bg-music');
            const musicBtn = document.getElementById('musicBtn');
            const container = document.querySelector('.container');

            let musicPlayed = false;
            let hasPlayedByScroll = false;
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isWechatIOS = isIOS && /MicroMessenger/i.test(navigator.userAgent);

            let isPlaying = false;
            updateMusicButtonState();

            musicBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleMusic();
            });
            musicBtn.addEventListener('touchstart', function (e) {
                e.preventDefault();
                toggleMusic();
            }, { passive: false });

            function toggleMusic() {
                if (bgMusic.paused) {
                    bgMusic.muted = false;
                    bgMusic.play().then(() => {
                        isPlaying = true;
                        musicPlayed = true;
                        updateMusicButtonState();
                    }).catch(err => {
                        console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', err);
                        if (isIOS) {
                            alert('è¯·ç‚¹å‡»"å…è®¸"æ’­æ”¾éŸ³ä¹');
                        }
                    });
                } else {
                    bgMusic.pause();
                    isPlaying = false;
                    updateMusicButtonState();
                }
            }

            function updateMusicButtonState() {
                if (bgMusic.paused) {
                    musicBtn.classList.remove('playing');
                    musicBtn.classList.add('paused');
                    musicBtn.innerHTML = '&#127928;';
                    musicBtn.title = 'ç‚¹å‡»æ’­æ”¾éŸ³ä¹';
                } else {
                    musicBtn.classList.add('playing');
                    musicBtn.classList.remove('paused');
                    musicBtn.innerHTML = '&#127928;';
                    musicBtn.title = 'ç‚¹å‡»æš‚åœéŸ³ä¹';
                }
            }

            bgMusic.addEventListener('play', () => {
                isPlaying = true;
                updateMusicButtonState();
            });

            bgMusic.addEventListener('pause', () => {
                isPlaying = false;
                updateMusicButtonState();
            });

            bgMusic.addEventListener('error', () => {
                console.log('éŸ³é¢‘åŠ è½½é”™è¯¯');
                musicBtn.innerHTML = '&#127928;';
                musicBtn.title = 'éŸ³ä¹åŠ è½½å¤±è´¥';
            });

            let touchPlayDebounce = false;
            function playMusicOnWechatScroll() {
                if (touchPlayDebounce || hasPlayedByScroll || !bgMusic.paused) return;
                touchPlayDebounce = true;
                bgMusic.play().then(() => {
                    isPlaying = true;
                    musicPlayed = true;
                    hasPlayedByScroll = true;
                    updateMusicButtonState();
                }).catch(err => {
                    console.log('æ»‘åŠ¨è§¦å‘æ’­æ”¾å¤±è´¥:', err);
                    musicBtn.title = 'ç‚¹å‡»æ’­æ”¾éŸ³ä¹';
                });
                setTimeout(() => { touchPlayDebounce = false; }, 1000);
            }

            container.addEventListener('touchstart', playMusicOnWechatScroll, {
                passive: true,
                capture: true
            });

            container.addEventListener('touchmove', playMusicOnWechatScroll, {
                passive: true,
                capture: true
            });

            window.addEventListener('scroll', playMusicOnWechatScroll, { passive: true });
            container.addEventListener('wheel', playMusicOnWechatScroll, { passive: true });

            function setupCountdown() {
                const weddingTime = new Date("2026-02-13 13:14:00").getTime();
                const els = {
                    days: document.getElementById('days'),
                    hours: document.getElementById('hours'),
                    minutes: document.getElementById('minutes'),
                    seconds: document.getElementById('seconds')
                };

                function update() {
                    const diff = weddingTime - new Date().getTime();
                    if (diff <= 0) {
                        Object.values(els).forEach(el => el.innerText = '00');
                        return;
                    }
                    els.days.innerText = Math.floor(diff / 86400000).toString().padStart(2, '0');
                    els.hours.innerText = Math.floor((diff % 86400000) / 3600000).toString().padStart(2, '0');
                    els.minutes.innerText = Math.floor((diff % 3600000) / 60000).toString().padStart(2, '0');
                    els.seconds.innerText = Math.floor((diff % 60000) / 1000).toString().padStart(2, '0');
                }
                update();
                setInterval(update, 1000);
            }

            function setupVisibilityHandler() {
                let hidden, visibilityChange;
                if (typeof document.hidden !== "undefined") {
                    hidden = "hidden";
                    visibilityChange = "visibilitychange";
                } else if (typeof document.msHidden !== "undefined") {
                    hidden = "msHidden";
                    visibilityChange = "msvisibilitychange";
                } else if (typeof document.webkitHidden !== "undefined") {
                    hidden = "webkitHidden";
                    visibilityChange = "webkitvisibilitychange";
                }

                function handleVisibilityChange() {
                    if (document[hidden]) {
                        if (!bgMusic.paused) bgMusic.pause();
                    } else {
                        if (musicPlayed && bgMusic.paused) {
                            bgMusic.play().catch(() => { });
                        }
                    }
                }

                if (typeof document.addEventListener !== "undefined" && hidden !== undefined) {
                    document.addEventListener(visibilityChange, handleVisibilityChange, false);
                }
            }

            setupCountdown();
            setupVisibilityHandler();
            musicBtn.title = 'ç‚¹å‡»æ’­æ”¾/æš‚åœéŸ³ä¹';
        }

        // ========== 6. å¼€å§‹é¢„åŠ è½½ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ==========
        // ã€ä¼˜åŒ–ã€‘æ‰€æœ‰è®¾å¤‡éƒ½ç”¨DOMContentLoadedè§¦å‘ï¼Œä¸ç”¨åŒºåˆ†ç§»åŠ¨ç«¯/PCç«¯
        window.addEventListener('DOMContentLoaded', () => {
            preloadImages();
            // éŸ³é¢‘ä¸å†é¢„åŠ è½½ï¼Œæ³¨é‡Šæ‰
            // preloadAudio();
        });
    </script>
</body>

</html>